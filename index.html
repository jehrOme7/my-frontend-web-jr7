<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Caf√© App</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-10">

    <!-- Header -->
    <div class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-md md:max-w-6xl mx-auto px-5 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                <div class="w-8 h-8 bg-amber-500 rounded-lg flex items-center justify-center text-white">
                    <i class="fa-solid fa-mug-hot text-sm"></i>
                </div>
                My Caf√©
            </h1>
            
            <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Desktop -->
            <div class="hidden md:flex gap-6 text-gray-500 text-sm font-medium">
                <a href="#" class="hover:text-amber-500 transition">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="#" class="hover:text-amber-500 transition">‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
                <a href="#" class="hover:text-amber-500 transition">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</a>
            </div>

            <div class="text-xs font-medium text-amber-600 bg-amber-50 px-3 py-1 rounded-full border border-amber-100">
                <i class="fa-solid fa-circle text-[8px] mr-1 animate-pulse"></i> Online
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-md md:max-w-6xl mx-auto px-4 mt-6">

        <!-- Grid Layout: ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 1 ‡∏ä‡πà‡∏≠‡∏á / ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå 12 ‡∏ä‡πà‡∏≠‡∏á -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-start">
            
            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á (‡∏ã‡πâ‡∏≤‡∏¢) -->
            <div class="md:col-span-4 lg:col-span-4 sticky top-24">
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-20 h-20 bg-amber-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>

                    <h2 class="text-lg font-bold text-gray-800 mb-4 relative z-10">‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                    
                    <div class="space-y-4 relative z-10">
                        <div>
                            <label class="text-xs text-gray-400 ml-1 mb-1 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</label>
                            <div class="relative">
                                <select id="menu-selector" class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-700 appearance-none focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all cursor-pointer">
                                    <option value="" disabled selected>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°...</option>
                                </select>
                                <div class="absolute left-3 top-3.5 text-gray-400">
                                    <i class="fa-solid fa-martini-glass-citrus"></i>
                                </div>
                                <div class="absolute right-3 top-3.5 text-gray-400 pointer-events-none">
                                    <i class="fa-solid fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-xl border border-amber-100">
                            <span class="text-gray-600 font-medium">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏ß</span>
                            <span id="price-display" class="text-2xl font-bold text-amber-600">0 ‡∏ø</span>
                        </div>

                        <button onclick="addProduct()" class="w-full bg-gray-900 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-xl hover:bg-gray-800 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-plus-circle"></i>
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ç‡∏ß‡∏≤) -->
            <div class="md:col-span-8 lg:col-span-8">
                <div class="flex items-center justify-between mb-4 px-1">
                    <h3 class="text-gray-800 font-bold text-lg flex items-center gap-2">
                        <i class="fa-solid fa-list-ul text-amber-500"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    </h3>
                    <button onclick="loadProducts()" class="text-gray-400 hover:text-amber-500 transition bg-white p-2 rounded-lg shadow-sm border border-gray-100">
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                </div>

                <div id="loading" class="hidden py-12 text-center">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-gray-200 border-t-amber-500"></div>
                    <p class="text-gray-400 text-sm mt-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                </div>

                <!-- Grid ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ 1 ‡πÅ‡∏ñ‡∏ß / ‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå 2 ‡πÅ‡∏ñ‡∏ß -->
                <ul id="product-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3 pb-20">
                    <!-- JS ‡∏à‡∏∞‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                </ul>
            </div>

        </div>
    </div>

    <!-- ‡πÉ‡∏™‡πà Script ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ä‡∏±‡∏ß‡∏£‡πå 100% -->
    <script>
        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ---
        const BASE_URL = 'https://my-api-server-jr7.onrender.com(https://my-api-server-jr7.onrender.com)';

    
        const MENU_ITEMS = [
            { name: "Iced Americano", price: 60, icon: "‚òï" },
            { name: "Iced Latte", price: 70, icon: "ü•õ" },
            { name: "Cappuccino", price: 75, icon: "ü•Ø" },
            { name: "Caramel Macchiato", price: 85, icon: "üçØ" },
            { name: "Green Tea Latte", price: 65, icon: "üçµ" },
            { name: "Thai Tea", price: 55, icon: "üß°" },
            { name: "Peach Tea", price: 60, icon: "üçë" },
            { name: "Cocoa Rich", price: 65, icon: "üç´" },
            { name: "Strawberry Soda", price: 50, icon: "üçì" },
            { name: "Blueberry Cheesecake", price: 120, icon: "üç∞" }
        ];

        const IMAGES = {
            "Coffee": "[https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?w=500&q=80](https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?w=500&q=80)",
            "Tea": "[https://images.unsplash.com/photo-1627435601361-ec25f5b1d0e5?w=500&q=80](https://images.unsplash.com/photo-1627435601361-ec25f5b1d0e5?w=500&q=80)",
            "Choco": "[https://images.unsplash.com/photo-1572490122747-3968b75cc699?w=500&q=80](https://images.unsplash.com/photo-1572490122747-3968b75cc699?w=500&q=80)",
            "Soda": "[https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=500&q=80](https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=500&q=80)",
            "Cake": "[https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=500&q=80](https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=500&q=80)",
            "Default": "[https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=500&q=80](https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=500&q=80)"
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        initMenu();
        loadProducts();

        // --- Functions ---

        function initMenu() {
            const selector = document.getElementById('menu-selector');
            const priceDisplay = document.getElementById('price-display');

            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß
            selector.innerHTML = '<option value="" disabled selected>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°...</option>';

            MENU_ITEMS.forEach(item => {
                const option = document.createElement('option');
                option.value = JSON.stringify(item);
                option.textContent = `${item.icon} ${item.name}`;
                selector.appendChild(option);
            });

            selector.addEventListener('change', (e) => {
                try {
                    const selectedItem = JSON.parse(e.target.value);
                    priceDisplay.textContent = `${selectedItem.price} ‡∏ø`;
                } catch (err) {
                    console.error("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", err);
                }
            });
        }

        function getImageFromName(name) {
            if(!name) return IMAGES.Default;
            const lower = name.toLowerCase();
            if (lower.includes("tea") || lower.includes("cha")) return IMAGES.Tea;
            if (lower.includes("choco") || lower.includes("cocoa")) return IMAGES.Choco;
            if (lower.includes("soda")) return IMAGES.Soda;
            if (lower.includes("cake") || lower.includes("cheese")) return IMAGES.Cake;
            if (lower.includes("coffee") || lower.includes("latte") || lower.includes("americano")) return IMAGES.Coffee;
            return IMAGES.Default;
        }

        async function loadProducts() {
            const loader = document.getElementById('loading');
            const list = document.getElementById('product-list');
            
            if(loader) loader.style.display = 'block';
            if(list) list.innerHTML = '';

            try {
                const response = await fetch(`${BASE_URL}/api/products`);
                if (!response.ok) throw new Error("Server ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á");
                
                const data = await response.json();
                
                if(loader) loader.style.display = 'none';

                if (data.length === 0) {
                    list.innerHTML = `<div class="col-span-1 sm:col-span-2 text-center py-10 opacity-50"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p></div>`;
                    return;
                }

                data.forEach((item) => {
                    const imageUrl = getImageFromName(item.name);
                    const li = document.createElement('li');
                    
                    li.className = "bg-white p-3 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition-all duration-300";
                    
                    li.innerHTML = `
                        <div class="flex items-center gap-3">
                            <img src="${imageUrl}" class="w-14 h-14 rounded-xl object-cover shadow-sm">
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm mb-1">${item.name}</h4>
                                <span class="text-amber-600 font-bold text-sm bg-amber-50 px-2 py-0.5 rounded-md">${item.price} ‡∏ø</span>
                            </div>
                        </div>
                        <div class="flex gap-1 pl-2">
                            <button onclick="updateProduct('${item._id}', '${item.name}', ${item.price})" class="w-9 h-9 rounded-full text-gray-400 hover:bg-amber-50 hover:text-amber-600 flex items-center justify-center transition"><i class="fa-solid fa-pen text-xs"></i></button>
                            <button onclick="deleteProduct('${item._id}')" class="w-9 h-9 rounded-full text-gray-400 hover:bg-red-50 hover:text-red-500 flex items-center justify-center transition"><i class="fa-solid fa-trash text-xs"></i></button>
                        </div>
                    `;
                    list.appendChild(li);
                });

            } catch (error) {
                console.error(error);
                if(loader) loader.innerHTML = '<p class="text-red-500 text-sm">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p>';
            }
        }

        async function addProduct() {
            const selector = document.getElementById('menu-selector');
            if (!selector.value) {
                selector.classList.add('ring-2', 'ring-red-400');
                setTimeout(() => selector.classList.remove('ring-2', 'ring-red-400'), 500);
                return;
            }

            const selectedItem = JSON.parse(selector.value);
            const btn = document.querySelector('button[onclick="addProduct()"]');
            
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';
            btn.disabled = true;

            try {
                await fetch(`${BASE_URL}/api/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: selectedItem.name, price: selectedItem.price })
                });
                
                loadProducts();
                selector.value = "";
                document.getElementById('price-display').textContent = "0 ‡∏ø";

            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
            } finally {
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        }

        async function deleteProduct(id) {
            if(!confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;
            await fetch(`${BASE_URL}/api/products/${id}`, { method: 'DELETE' });
            loadProducts();
        }

        async function updateProduct(id, oldName, oldPrice) {
            const newPrice = prompt(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏Ñ‡∏≤ ${oldName}:`, oldPrice);
            if (newPrice === null || newPrice === "") return;

            await fetch(`${BASE_URL}/api/products/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: oldName, price: parseInt(newPrice) })
            });
            loadProducts();
        }
    </script>
</body>
</html>